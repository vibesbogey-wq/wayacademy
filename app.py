import os
import requests
from flask import Flask, request

from dotenv import load_dotenv
from openai import OpenAI

# ---------------- ENV –ê–ß–ê–ê–õ–õ–ê–• ---------------- #

load_dotenv()

PAGE_ACCESS_TOKEN = os.getenv("PAGE_ACCESS_TOKEN")
VERIFY_TOKEN = os.getenv("VERIFY_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

if not PAGE_ACCESS_TOKEN:
    raise RuntimeError("PAGE_ACCESS_TOKEN environment variable –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞!")
if not VERIFY_TOKEN:
    raise RuntimeError("VERIFY_TOKEN environment variable –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞!")
if not OPENAI_API_KEY:
    raise RuntimeError("OPENAI_API_KEY environment variable –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞!")

client = OpenAI(api_key=OPENAI_API_KEY)

app = Flask(__name__)

# ---------------- –•”®–¢”®–õ–ë”®–†“Æ“Æ–î–ò–ô–ù –î–ê–¢–ê ---------------- #

COURSE_DATA = [
    {
        "course_name": "–°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –î–∏–∂–∏—Ç–∞–ª –ú–∞—Ä–∫–µ—Ç–µ—Ä",
        "keywords": [
            "—Å—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–µ—Ä", "digital marketer", "–¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥",
            "–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω —Ö”©—Ç”©–ª–±”©—Ä", "–º–∞—Ä–∫–µ—Ç–µ—Ä", "facebook —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞",
            "instagram —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞", "seo", "blue ocean"
        ],
        "description": (
            "–¢–∞–∞–º–∞–≥–ª–∞—Ö–∞–∞ –±–æ–ª—å, “Ø—Ä –¥“Ø–Ω–≥ —É–¥–∏—Ä–¥! –≠–Ω—ç —Ö”©—Ç”©–ª–±”©—Ä –Ω—å –∫–∞—Ä—å–µ—Ä–∞–∞ —ç—Ö–ª“Ø“Ø–ª—ç—Ö, "
            "–±–∏–∑–Ω–µ—Å—ç—ç ”©—Å–≥”©—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —Ö“Ø–Ω –±“Ø—Ä—Ç –∑–æ—Ä–∏—É–ª–∞–≥–¥—Å–∞–Ω.\n\n"
            "–ë–∏–¥ —Ç–∞–Ω–¥ –∑”©–≤—Ö”©–Ω 'Boost' –¥–∞—Ä–∞—Ö—ã–≥ –∑–∞–∞—Ö–≥“Ø–π. –•–∞—Ä–∏–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –∞—Ö–∏—Å–∞–Ω —Ç“Ø–≤—à–Ω–∏–π —à–∏–Ω–∂–∏–ª–≥—ç—ç, "
            "Blue Ocean Strategy, —à–∏–ª–¥—ç–≥ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö —É—Ä —á–∞–¥–≤–∞—Ä, "
            "Facebook / Instagram —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞–Ω—ã –∞—Ö–∏—Å–∞–Ω —Ç“Ø–≤—à–Ω–∏–π —Ç–µ—Ö–Ω–∏–∫“Ø“Ø–¥, “Ø–Ω—ç —Ü—ç–Ω—Ç—ç–π –∫–æ–Ω—Ç–µ–Ω—Ç "
            "–±“Ø—Ç—ç—ç—Ö —É—Ä–ª–∞–≥–∞–∞—Å —ç—Ö–ª—ç—ç–¥ SEO —Ö“Ø—Ä—Ç—ç–ª –¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω —Ü–æ–≥—Ü —É—Ä —á–∞–¥–≤–∞—Ä—ã–≥ —ç–∑—ç–º—à“Ø“Ø–ª–Ω—ç.\n\n"
            "–¢”©–≥—Å”©”©–¥:\n"
            "‚Ä¢ Meta –æ–ª–æ–Ω —É–ª—Å—ã–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç + Blockchain –±–∞—Ç–∞–ª–≥–∞–∞–∂—Å–∞–Ω –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç\n"
            "‚Ä¢ –ë–æ–¥–∏—Ç —Ç”©—Å”©–ª –¥—ç—ç—Ä –∞–∂–∏–ª–ª–∞–∂ –æ—Ä–ª–æ–≥–æ –æ–ª–∂ —ç—Ö–ª—ç—Ö –±–æ–ª–æ–º–∂"
        ),
        "teacher": "–≠. –≠–Ω—Ö–∑–∞—è–∞ (Way Academy-–∏–π–Ω “Ø“Ø—Å–≥—ç–Ω –±–∞–π–≥—É—É–ª–∞–≥—á, CEO)",
        "duration": "5 —Å–∞—Ä (7 —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)",
        "schedule": {
            "evening": "–û—Ä–æ–π–Ω –∞–Ω–≥–∏: –ú—è–≥–º–∞—Ä, –ü“Ø—Ä—ç–≤ 18:00‚Äì21:00",
            "daytime": "”®–¥—Ä–∏–π–Ω –∞–Ω–≥–∏: –õ—Ö–∞–≥–≤–∞, –ë—è–º–±–∞ 14:00‚Äì17:00"
        },
        "price": {
            "full": None,
            "discount": None,
            "discount_until": None
        },
        "payment_options": [
            "–¢”©–ª–±”©—Ä–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –º–µ–Ω–µ–∂–µ—Ä—Ç—ç–π —Ö–æ–ª–±–æ–≥–¥–æ–Ω –ª–∞–≤–ª–∞–Ω–∞ —É—É. (99201187)"
        ]
    },
    {
        "course_name": "Data Analyst",
        "keywords": [
            "data analyst", "–¥–∞—Ç–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫", "”©–≥”©–≥–¥–ª–∏–π–Ω —à–∏–Ω–∂—ç—ç—á",
            "”©–≥”©–≥–¥”©–ª", "–∞–Ω–∞–ª–∏—Å—Ç", "python", "google —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
        ],
        "description": (
            "”®–≥”©–≥–¥–ª–∏–π–Ω —à–∏–Ω–∂—ç—ç—á–∏–π–Ω –º—ç—Ä–≥—ç–∂–∏–ª —ç–∑—ç–º—à“Ø“Ø–ª—ç—Ö 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä—Ç–∞–π —Ö”©—Ç”©–ª–±”©—Ä.\n\n"
            "‚Ä¢ –û–ª–æ–Ω —É–ª—Å–∞–¥ –∑”©–≤—à”©”©—Ä”©–≥–¥”©—Ö Google-–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±–æ–ª–æ–Ω –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ö–æ—Å–æ–ª—Å–æ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—Ç–∞–π\n"
            "‚Ä¢ ”®–≥”©–≥–¥”©–ª –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∂ —à–∏–Ω–∂–ª—ç—Ö, “Ø—Ä –¥“Ø–Ω–≥ —Ç–∞–π–ª–∞–≥–Ω–∞—Ö –∞—Ä–≥–∞—á–ª–∞–ª—É—É–¥—ã–≥ —Å—É—Ä–∞–ª—Ü–∞–Ω–∞\n"
            "‚Ä¢ Python –ø—Ä–æ–≥—Ä–∞–º–º –¥—ç—ç—Ä –¥–∞—Ç–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏–π–Ω –∞—Ö–∏—Å–∞–Ω —Ç“Ø–≤—à–Ω–∏–π —Ö—ç—Ä—ç–≥—Å–ª“Ø“Ø–¥–∏–π–≥ –ø—Ä–∞–∫—Ç–∏–∫—Ç –∞—à–∏–≥–ª–∞–∂ —Å—É—Ä–Ω–∞\n"
            "‚Ä¢ –¢“Ø–Ω—à –∫–æ–º–ø–∞–Ω–∏—É–¥—ã–Ω —Ç”©—Å”©–ª –¥—ç—ç—Ä –¥–∞–¥–ª–∞–≥–∞ —Ö–∏–π–∂, —Ç”©–≥—Å”©”©–¥ —à—É—É–¥ –∞–∂–ª—ã–Ω –±–∞–π—Ä–∞–Ω–¥ –∑—É—É—á–ª—É—É–ª–∞—Ö –±–æ–ª–æ–º–∂—Ç–æ–π\n\n"
            "”®–≥”©–≥–¥”©–ª–¥ —Å—É—É—Ä–∏–ª—Å–∞–Ω —à–∏–π–¥–≤—ç—Ä –≥–∞—Ä–≥–∞–∂, –±–∏–∑–Ω–µ—Å–∏–π–Ω –∞–º–∂–∏–ª—Ç—ã–≥ –¥—ç–º–∂–∏—Ö —á–∞–¥–≤–∞—Ä–∞–∞ —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö–∏–π–≥ "
            "—Ö“Ø—Å—ç–∂ –±–∞–π–≤–∞–ª —ç–Ω—ç —Ö”©—Ç”©–ª–±”©—Ä —Ç–∞–Ω–¥ –∑–æ—Ä–∏—É–ª–∞–≥–¥—Å–∞–Ω."
        ),
        "teacher": "–ß. –ê–ª—Ç–∞–Ω-”®–ª–∑–∏–π (Data Analyst-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à)",
        "duration": "4 —Å–∞—Ä",
        "schedule": {
            "weekend": "–ê–º—Ä–∞–ª—Ç—ã–Ω ”©–¥—Ä–∏–π–Ω –∞–Ω–≥–∏: –ë—è–º–±–∞, –ù—è–º 11:00‚Äì14:00 (–¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)",
            "weekday": "–ê–∂–ª—ã–Ω ”©–¥—Ä–∏–π–Ω –∞–Ω–≥–∏: –î–∞–≤–∞–∞, –õ—Ö–∞–≥–≤–∞ 19:00‚Äì22:00 (–¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)"
        },
        "price": {
            "full": "5,842,000‚ÇÆ",
            "discount": "5,242,000‚ÇÆ",
            "discount_until": "8 —Å–∞—Ä—ã–Ω 31 —Ö“Ø—Ä—Ç—ç–ª (Final Chance)"
        },
        "payment_options": [
            "–£—Ä—å–¥—á–∏–ª–≥–∞–∞ 500,000‚Äì1,500,000‚ÇÆ —Ç”©–ª”©”©–¥ “Ø–ª–¥—Å—ç–Ω —Ç”©–ª–±”©—Ä”©”© 2025/12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª —Å–∞—Ä –±“Ø—Ä —Ö—É–≤–∞–∞–∂ —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π.",
            "PocketZero-–æ–æ—Ä 12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª—Ö —Ö“Ø“Ø–≥“Ø–π, —à–∏–º—Ç–≥—ç–ª–≥“Ø–π —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π."
        ]
    },
    {
        "course_name": "IT Business Analyst",
        "keywords": [
            "it business analyst", "–∏—Ç –±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Å—Ç", "–±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Å—Ç",
            "business analyst", "–±–∞ –±–∏–∑–Ω–µ—Å —à–∏–Ω–∂—ç—ç—á", "it –±–∞"
        ],
        "description": (
            "IT Business Analyst –º—ç—Ä–≥—ç–∂–∏–ª —ç–∑—ç–º—à“Ø“Ø–ª—ç—Ö 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä—Ç–∞–π —Ö”©—Ç”©–ª–±”©—Ä.\n\n"
            "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏ –±–æ–ª–æ–Ω –±–∏–∑–Ω–µ—Å–∏–π–Ω –º—ç–¥–ª—ç–≥, —É—Ä —á–∞–¥–≤–∞—Ä—ã–≥ —Ü–æ–≥—Ü–ª–æ–æ—Å–æ–Ω –º—ç—Ä–≥—ç–∂–∏–ª—Ç—ç–Ω –±–æ–ª–∂ "
            "—Ö”©–¥”©–ª–º”©—Ä–∏–π–Ω –∑–∞—Ö –∑—ç—ç–ª–¥ –¥–∞–≤–∞–º–≥–∞–π–ª–Ω–∞.\n\n"
            "‚Ä¢ –ë–∏–∑–Ω–µ—Å–∏–π–Ω “Ø–π–ª –∞–∂–∏–ª–ª–∞–≥–∞–∞–≥ –æ–Ω–æ–≤—á—Ç–æ–π –±–æ–ª–≥–æ—Ö, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω —à–∏–π–¥—ç–ª –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö —á–∞–¥–≤–∞—Ä —ç–∑—ç–º—à–∏–Ω—ç\n"
            "‚Ä¢ –ü—Ä–æ—Ü–µ—Å—Å—ã–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç, —Ç”©—Å–ª–∏–π–Ω –º–µ–Ω–µ–∂–º–µ–Ω—Ç–∏–π–Ω –∞—Ä–≥–∞ –±–∞—Ä–∏–ª–¥ —Å—É—Ä–∞–ª—Ü–∞–Ω–∞\n"
            "‚Ä¢ –ú–æ–Ω–≥–æ–ª—ã–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω –∫–æ–º–ø–∞–Ω–∏—É–¥—ã–Ω –±–æ–¥–∏—Ç —Ç”©—Å”©–ª –¥—ç—ç—Ä –ø—Ä–∞–∫—Ç–∏–∫ —Ö–∏—á—ç—ç–ª —Ö–∏–π–Ω—ç\n"
            "‚Ä¢ –ú—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—Ç–∞–π, 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä–∞–Ω–¥ –±—ç–ª—Ç–≥—ç–≥–¥—ç–Ω—ç"
        ),
        "teacher": "–¢. –ë–∞—Ç–∑–∞—è–∞ (–¢–µ—Ö–Ω–æ–ª–æ–≥–∏ —Ö–∞—Ä–∏—É—Ü—Å–∞–Ω –∑–∞—Ö–∏—Ä–∞–ª, –º–∞—Å—Ç–µ—Ä –±–∞–≥—à)",
        "duration": "3 —Å–∞—Ä",
        "schedule": {
            "weekday": "–ú—è–≥–º–∞—Ä, –ü“Ø—Ä—ç–≤ 19:00‚Äì22:00 (–¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)"
        },
        "price": {
            "full": None,
            "discount": None,
            "discount_until": None
        },
        "payment_options": [
            "–¢”©–ª–±”©—Ä, —Ö”©–Ω–≥”©–ª”©–ª—Ç–∏–π–Ω —Ç–∞–ª–∞–∞—Ä –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π–≥ –º–µ–Ω–µ–∂–µ—Ä—Ç—ç–π —Ö–æ–ª–±–æ–≥–¥–æ–Ω –ª–∞–≤–ª–∞–Ω–∞ —É—É. (99201187)"
        ]
    },
    {
        "course_name": "Project Zero: AI Agent Developer (Code the Future)",
        "keywords": [
            "project zero", "ai agent", "ai agent developer", "code the future",
            "agent developer", "ai developer", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä", "–¥–∏–∂–∏—Ç–∞–ª –∞–∂–∏–ª—Ç–∞–Ω"
        ],
        "description": (
            "Project Zero: Code the Future –Ω—å —Ç–∞–Ω—ã–≥ AI —Ö—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å AI –±“Ø—Ç—ç—ç–≥—á '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä' –±–æ–ª–≥–æ–Ω —Ö—É–≤–∏—Ä–≥–∞—Ö "
            "–æ–Ω—Ü–≥–æ–π 4 —Å–∞—Ä—ã–Ω –∞—è–ª–∞–ª —é–º.\n\n"
            "–¢–∞ —ç–Ω—ç –∞—è–ª–ª—ã–≥ –ú–æ–Ω–≥–æ–ª—ã–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω —Å–∞–ª–±–∞—Ä—ã–Ω —à–∏–ª–¥—ç–≥ —ç–∫—Å–ø–µ—Ä—Ç –ó. –ë–∞—Ç–∑–∞—è–∞-—Å —à—É—É–¥ "
            "—Å—É—Ä–∞–ª—Ü–∞–Ω —ç—Ö–ª“Ø“Ø–ª–Ω—ç. –¢–∞ —É—Ö–∞–∞–ª–∞–≥ —á–∞—Ç–±–æ—Ç, –¥–∞—Ç–∞ –∞–Ω–∞–ª–∏—Å—Ç –∞–≥–µ–Ω—Ç –∑—ç—Ä—ç–≥ –±–æ–¥–∏—Ç –∞—Å—É—É–¥–∞–ª —à–∏–π–¥–¥—ç–≥ "
            "'–¥–∏–∂–∏—Ç–∞–ª –∞–∂–∏–ª—Ç–∞–Ω'-—É—É–¥—ã–≥ ”©”©—Ä–∏–π–Ω –≥–∞—Ä–∞–∞—Ä –±“Ø—Ç—ç—ç—Ö –±–æ–ª–Ω–æ.\n\n"
            "–≠–ª—Å—ç–ª—Ç –Ω—å —Ç—É—Å–≥–∞–π, –∑”©–≤—Ö”©–Ω ”©—Ä–≥”©–¥–ª”©”©—Ä, —Ü”©”©–Ω —Ç–æ–æ–Ω—ã –∞–Ω—Ö–¥–∞–≥—á–¥—ã–≥ —Å–æ–Ω–≥–æ–Ω —à–∞–ª–≥–∞—Ä—É—É–ª–¥–∞–≥."
        ),
        "teacher": "–ó. –ë–∞—Ç–∑–∞—è–∞ (Project Zero, IT Business Analyst-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à)",
        "duration": "4 —Å–∞—Ä",
        "schedule": {
            "info": "–•—É–≤–∞–∞—Ä–∏–π–≥ ”©—Ä–≥”©–¥”©–ª –±–∞—Ç–ª–∞–≥–¥—Å–∞–Ω—ã –¥–∞—Ä–∞–∞ —ç—Ü—ç—Å–ª—ç–Ω —Ç–∞–Ω–∏–ª—Ü—É—É–ª–Ω–∞."
        },
        "price": {
            "full": "7,448,000‚ÇÆ",
            "discount": "6,640,000‚ÇÆ",
            "discount_until": "9 —Å–∞—Ä—ã–Ω 14 —Ö“Ø—Ä—Ç—ç–ª (Final Chance)"
        },
        "payment_options": [
            "–£—Ä—å–¥—á–∏–ª–≥–∞–∞ 1,000,000‚ÇÆ —Ç”©–ª”©”©–¥ “Ø–ª–¥—Å—ç–Ω —Ç”©–ª–±”©—Ä”©”© 2025/12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª —É—è–Ω —Ö–∞—Ç–∞–Ω —Ö—É–≤–∞–∞–∂ —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π.",
            "PocketZero-–æ–æ—Ä 12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª—Ö —Ö“Ø“Ø–≥“Ø–π, —à–∏–º—Ç–≥—ç–ª–≥“Ø–π —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π."
        ],
        "application_link": "https://forms.gle/qgyNEKecuJ22f5mYA"
    },
]

# ---------------- FAQ (–∞–∫–∞–¥–µ–º–∏, –±–∞–≥—à, –æ–Ω—Ü–ª–æ–≥, —Ö–æ–ª–±–æ–æ) ---------------- #

FAQ_LIST = [
    {
        "q_keywords": ["—Ö”©—Ç”©–ª–±”©—Ä", "—è–º–∞—Ä —Ö”©—Ç”©–ª–±”©—Ä", "course", "program", "programs", "—è–º–∞—Ä —è–º–∞—Ä –∞–Ω–≥–∏"],
        "answer": (
            "üéì Way Academy-–∏–π–Ω “Ø–Ω–¥—Å—ç–Ω —Ö”©—Ç”©–ª–±”©—Ä“Ø“Ø–¥:\n"
            "1) –°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –î–∏–∂–∏—Ç–∞–ª –ú–∞—Ä–∫–µ—Ç–µ—Ä\n"
            "2) Data Analyst\n"
            "3) IT Business Analyst\n"
            "4) Project Zero: AI Agent Developer (Code the Future)\n\n"
            "–¢–∞ –∞–ª—å —Ö”©—Ç”©–ª–±”©—Ä–∏–π–≥ —Å–æ–Ω–∏—Ä—Ö–æ–∂ –±–∞–π–Ω–∞ –≤—ç? –•”©—Ç”©–ª–±”©—Ä–∏–π–Ω –Ω—ç—Ä—ç—ç –±–∏—á–≤—ç–ª –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –∏–ª–≥—ç—ç–Ω—ç."
        ),
    },
    {
        "q_keywords": ["–æ–Ω—Ü–ª–æ–≥", "—è–ª–≥–∞—Ä–∞–ª", "way academy —é—É –Ω—å", "—è–∞–≥–∞–∞–¥ way academy"],
        "answer": (
            "Way Academy-–∏–π–Ω –≥–æ–ª –æ–Ω—Ü–ª–æ–≥ –Ω—å —Ö”©–¥”©–ª–º”©—Ä–∏–π–Ω –∑–∞—Ö –∑—ç—ç–ª –¥—ç—ç—Ä—Ö —Ö–∞–º–≥–∏–π–Ω —ç—Ä—ç–ª—Ç—Ç—ç–π —É—Ä —á–∞–¥–≤–∞—Ä—É—É–¥—ã–≥ "
            "—Å–∞–ª–±–∞—Ä—ã–Ω —à–∏–ª–¥—ç–≥ –º—ç—Ä–≥—ç–∂–∏–ª—Ç–Ω“Ø“Ø–¥—ç—ç—Å –±–æ–≥–∏–Ω–æ —Ö—É–≥–∞—Ü–∞–∞–Ω–¥ —ç–∑—ç–º—à“Ø“Ø–ª–∂, —à—É—É–¥ –∞–∂–∏–ª–ª–∞—Ö —ç—Å–≤—ç–ª –±–∏–∑–Ω–µ—Å—ç—ç "
            "—ç—Ä—á–∏–º–∂“Ø“Ø–ª—ç—Ö –±–æ–ª–æ–º–∂ –æ–ª–≥–æ–¥–æ–≥—Ç –æ—Ä—à–¥–æ–≥.\n\n"
            "–ë–∏–¥ –∞–∫–∞–¥–µ–º–∏–∫ —Ç“Ø–≤—à–Ω–∏–π —á–∞–Ω–∞—Ä—Ç–∞–π –±–æ–ª–æ–≤—Å—Ä–æ–ª–æ–æ—Ä —Ç–∞–Ω—ã –∞–ª—Ç–∞–Ω —Ü–∞–≥–∏–π–≥ —Ö—ç–º–Ω—ç–Ω—ç."
        ),
    },
    {
        "q_keywords": ["—Ö–∏–π–º—ç–ª –æ—é—É–Ω", "ai", "artificial intelligence", "—Ö–∞–∞–Ω–∞ ai", "ai –∞—à–∏–≥–ª–∞–¥–∞–≥ —É—É"],
        "answer": (
            "–ú–∞–Ω–∞–π –∞–∫–∞–¥–µ–º–∏–π–Ω –±“Ø—Ö —Ö”©—Ç”©–ª–±”©—Ä“Ø“Ø–¥—ç–¥ —Ö–∏–π–º—ç–ª –æ—é—É–Ω (AI)-–≥ —Ö—ç—Ä—Ö—ç–Ω –∞—à–∏–≥–ª–∞–∂ –≥“Ø–π—Ü—ç—Ç–≥—ç–ª, –±“Ø—Ç—ç—ç–º–∂—ç—ç "
            "–Ω—ç–º—ç–≥–¥“Ø“Ø–ª—ç—Ö–∏–π–≥ –∑–∞–∞–¥–∞–≥. –î–æ—Ç–æ–æ–¥ —Å—É—Ä–≥–∞–ª—Ç—ã–Ω —Å–∏—Å—Ç–µ–º (LMS) –Ω—å AI –¥—ç—ç—Ä —Å—É—É—Ä–∏–ª—Å–∞–Ω –±”©–≥”©”©–¥ —Å—É—Ä–∞–ª—Ü–∞–≥—á–¥—ã–Ω "
            "–∏–¥—ç–≤—Ö–∏, –≥“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–≥ —Ç–æ–æ—Ü–æ–æ–ª–∂ –∑”©–≤–ª”©–º–∂ ”©–≥–¥”©–≥."
        ),
    },
    {
        "q_keywords": ["—Ç–∞—Å—Ä–∞–ª—Ç–≥“Ø–π —Ö”©–≥–∂“Ø“Ø–ª—ç–ª—Ç", "continuous development", "—Ç”©–≥—Å”©”©–¥ —è–∞—Ö –≤—ç"],
        "answer": (
            "Way Academy –Ω—å Continuous Development –±—É—é—É —Ç–∞—Å—Ä–∞–ª—Ç–≥“Ø–π —Ö”©–≥–∂“Ø“Ø–ª—ç–ª—Ç–∏–π–Ω –∑–∞—Ä—á–º–∞–∞—Ä –∞–∂–∏–ª–ª–∞–¥–∞–≥. "
            "–¢–∞ –∑”©–≤—Ö”©–Ω —Å—É—Ä–≥–∞–ª—Ç—ã–Ω —Ö—É–≥–∞—Ü–∞–∞–Ω–¥ –±–∏—à, —Ç”©–≥—Å—Å”©–Ω–∏–π –¥–∞—Ä–∞–∞ —á –±–∏–¥–Ω—ç—ç—Å —à–∏–Ω—ç –º—ç–¥–ª—ç–≥, —á–∏–≥ —Ö–∞–Ω–¥–ª–∞–≥–∞, "
            "–∫–∞—Ä—å–µ—Ä—ã–Ω –¥—ç–º–∂–ª—ç–≥–∏–π–≥ –∞–≤–∞–∞–¥ —è–≤–Ω–∞."
        ),
    },
    {
        "q_keywords": ["–±–∞–≥—à", "teacher", "–±–∞–≥—à –Ω–∞—Ä", "mentors", "—ç–∫—Å–ø–µ—Ä—Ç"],
        "answer": (
            "–ú–∞–Ω–∞–π –±–∞–≥—à –Ω–∞—Ä –Ω—å –ú–æ–Ω–≥–æ–ª—ã–Ω —Ç–æ–º–æ–æ—Ö–æ–Ω –≥—Ä—É–ø–ø –∫–æ–º–ø–∞–Ω–∏—É–¥, —Ñ–∏–Ω—Ç–µ–∫, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω –±–∞–π–≥—É—É–ª–ª–∞–≥—É—É–¥–∞–¥ "
            "C-level —Ç“Ø–≤—à–∏–Ω–¥ –∞–∂–∏–ª–ª–∞—Å–∞–Ω, –±–æ–¥–∏—Ç –±–∏–∑–Ω–µ—Å–∏–π–Ω –∫—ç–π—Å –¥—ç—ç—Ä –æ–ª–æ–Ω –∂–∏–ª –∞–∂–∏–ª–ª–∞—Å–∞–Ω —ç–∫—Å–ø–µ—Ä—Ç“Ø“Ø–¥ –±–∞–π–Ω–∞.\n\n"
            "–ñ–∏—à—ç—ç –Ω—å:\n"
            "‚Ä¢ –¢. –ë–∞—Ç–∑–∞—è–∞ ‚Äî Project Zero, IT Business Analyst-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à, —Ö—ç–¥ —Ö—ç–¥—ç–Ω –∫–æ–º–ø–∞–Ω–∏–π–Ω CTO\n"
            "‚Ä¢ –ß. –ê–ª—Ç–∞–Ω-”®–ª–∑–∏–π ‚Äî Data Analyst-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à, Ard Financial Group-–∏–π–Ω Chief Data Officer\n"
            "‚Ä¢ –≠. –≠–Ω—Ö–∑–∞—è–∞ ‚Äî Strategy Digital Marketing-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à, Way Academy-–∏–π–Ω “Ø“Ø—Å–≥—ç–Ω –±–∞–π–≥—É—É–ª–∞–≥—á, CEO\n"
            "‚Ä¢ –ú–µ–Ω—Ç–æ—Ä—É—É–¥: –ñ. –û—é—É–Ω—á–∏–º—ç–≥ (–¢–∞–≤–∞–Ω –ë–æ–≥–¥ –•–æ–ª–¥–∏–Ω–≥—Å CMO), –ë. –ù–∞–Ω–¥–∏–Ω-–≠—Ä–¥—ç–Ω—ç (–ê–∫—Å–∏–º–æ –ò–Ω–∫ “Ø“Ø—Å–≥—ç–Ω –±–∞–π–≥—É—É–ª–∞–≥—á)\n"
        ),
    },
    {
        "q_keywords": ["—Å—É—É—Ä—å –º—ç–¥–ª—ç–≥", "—Å—É—É—Ä—å –±–∞–π—Ö —Ö—ç—Ä—ç–≥—Ç—ç–π —é—É", "—É—Ä—å–¥—á–∏–ª—Å–∞–Ω –º—ç–¥–ª—ç–≥", "–∞–Ω—Ö–∞–Ω —à–∞—Ç"],
        "answer": (
            "–ú–∞–Ω–∞–π —Ö”©—Ç”©–ª–±”©—Ä“Ø“Ø–¥–∏–π–≥ –∞–Ω—Ö–∞–Ω —à–∞—Ç–Ω–∞–∞—Å –Ω—å —Å–∏—Å—Ç–µ–º—Ç—ç–π–≥—ç—ç—Ä –∑–∞–∞—Ö–∞–∞—Ä —Ç”©–ª”©–≤–ª”©—Å”©–Ω. "
            "–¢–∏–π–º—ç—ç—Å —Ç–∞ —è–º–∞—Ä —á —Å—É—É—Ä—å –æ–π–ª–≥–æ–ª—Ç–≥“Ø–π –±–∞–π–∂ –±–æ–ª–Ω–æ. –ë–∏–¥ —Ç–∞–Ω—ã —Ç“Ø–≤—à–∏–Ω–¥ —Ç–æ—Ö–∏—Ä—É—É–ª–∂ —à–∞—Ç –¥–∞—Ä–∞–∞—Ç–∞–π "
            "–∑–∞–∞–Ω–∞. –ì–æ–ª –Ω—å —Ç—É—É—à—Ç–∞–π –±–∞–π–¥–∞–ª, —Å—É—Ä–∞—Ö —Ö“Ø—Å—ç–ª —Ö—ç—Ä—ç–≥—Ç—ç–π."
        ),
    },
    {
        "q_keywords": ["–∫–ª—É–±", "club", "—Ö–∏—á—ç—ç–ª—ç—ç—Å –≥–∞–¥–Ω–∞", "extracurricular", "–¥—ç–º–∂–ª—ç–≥"],
        "answer": (
            "–°—É—Ä–≥–∞–ª—Ç–∞–∞—Å –≥–∞–¥–Ω–∞ –±–∏–¥ —Å–æ–Ω–∏—Ä—Ö–æ–≥—á–¥—ã–Ω –∫–ª—É–±—É—É–¥—Ç–∞–π:\n"
            "‚Ä¢ –ê–Ω–≥–ª–∏ —Ö—ç–ª–Ω–∏–π —è—Ä–∏–∞–Ω—ã –∫–ª—É–±\n"
            "‚Ä¢ –£—É–ª–∞–Ω–¥ –∞–ª—Ö–∞–≥—á–¥—ã–Ω –∫–ª—É–±\n"
            "‚Ä¢ –ö–∏–Ω–æ —Å–æ–Ω–∏—Ä—Ö–æ–≥—á–¥—ã–Ω –∫–ª—É–±\n"
            "‚Ä¢ –ë–∏–∑–Ω–µ—Å —ç—Ä—Ö–ª—ç–≥—á–¥–∏–π–Ω –∫–ª—É–±\n\n"
            "–≠–¥–≥—ç—ç—Ä –Ω—å —Ç–∞–Ω—ã —Å“Ø–ª–∂—ç—ç, —Ç—É—Ä—à–ª–∞–≥–∞, ”©”©—Ä–∏–π–≥”©”© —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö –æ—Ä—á–Ω—ã–≥ –∏–ª“Ø“Ø –±–∞—è–∂—É—É–ª–Ω–∞."
        ),
    },
    {
        "q_keywords": ["“Ø–Ω—ç —Ü—ç–Ω–∏–π–Ω —Å–∞–Ω–∞–ª", "value proposition", "—é—É–≥–∞–∞—Ä–∞–∞ ”©”©—Ä", "”©”©—Ä –∞–∫–∞–¥–µ–º–∏–∞—Å"],
        "answer": (
            "–ë–∏–¥–Ω–∏–π “Ø–Ω—ç —Ü—ç–Ω–∏–π —Å–∞–Ω–∞–ª –±–æ–ª: —Ö”©–¥”©–ª–º”©—Ä–∏–π–Ω –∑–∞—Ö –∑—ç—ç–ª –¥—ç—ç—Ä—Ö —Ö–∞–º–≥–∏–π–Ω —ç—Ä—ç–ª—Ç—Ç—ç–π –º—ç—Ä–≥—ç–∂–∏–ª, —É—Ä "
            "—á–∞–¥–≤–∞—Ä—É—É–¥—ã–≥ —Å–∞–ª–±–∞—Ä—ã–Ω —à–∏–ª–¥—ç–≥ –º—ç—Ä–≥—ç–∂–∏–ª—Ç–Ω“Ø“Ø–¥—ç—ç—Å –±–æ–≥–∏–Ω–æ —Ö—É–≥–∞—Ü–∞–∞–Ω–¥ —ç–∑—ç–º—à“Ø“Ø–ª–∂, —à—É—É–¥ –∞–∂–∏–ª–ª–∞—Ö "
            "—ç—Å–≤—ç–ª –±–∏–∑–Ω–µ—Å—ç—ç —ç—Ä—á–∏–º–∂“Ø“Ø–ª—ç—Ö –±–æ–ª–æ–º–∂ –æ–ª–≥–æ—Ö —è–≤–¥–∞–ª.\n\n"
            "–¢–æ–≤—á—Ö–æ–Ω–¥–æ–æ –±–∏–¥ —Ç–∞–Ω—ã –∞–ª—Ç–∞–Ω —Ü–∞–≥–∏–π–≥ ”©–Ω–¥”©—Ä —á–∞–Ω–∞—Ä—Ç–∞–π, –ø—Ä–∞–∫—Ç–∏–∫ –±–æ–ª–æ–≤—Å—Ä–æ–ª–æ–æ—Ä —Ö—ç–º–Ω—ç–Ω—ç."
        ),
    },
    {
        "q_keywords": ["—Ü–∞–≥", "–∞–∂–∏–ª–ª–∞—Ö —Ü–∞–≥", "—Ö—ç–∑—ç—ç –Ω—ç—ç–ª—Ç—Ç—ç–π", "schedule", "—Ö—É–≤–∞–∞—Ä—å", "working hours", "open"],
        "answer": (
            "üïí Way Academy-–∏–π–Ω –µ—Ä”©–Ω—Ö–∏–π –∞–∂–∏–ª–ª–∞—Ö —Ü–∞–≥:\n"
            "- –ê–∂–ª—ã–Ω ”©–¥”©—Ä: 10:00‚Äì20:00\n"
            "- –ê–º—Ä–∞–ª—Ç—ã–Ω ”©–¥”©—Ä (–ë—è–º–±–∞, –ù—è–º): 11:00‚Äì18:00\n"
            "–ö—É—Ä—Å —Ç—É—Å –±“Ø—Ä–∏–π–Ω –Ω–∞—Ä–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å ”©”©—Ä —Ç—É–ª —Å–æ–Ω–∏—Ä—Ö–æ–∂ –±—É–π —Ö”©—Ç”©–ª–±”©—Ä–∏–π–Ω –Ω—ç—Ä—ç—ç –±–∏—á—ç—ç—Ä—ç–π."
        ),
    },
    {
        "q_keywords": ["—Ö–∞—è–≥", "–±–∞–π—Ä—à–∏–ª", "location", "address", "—Ö–∞–∞–Ω–∞ –±–∞–π–¥–∞–≥"],
        "answer": (
            "üìç –ê–∫–∞–¥–µ–º–∏–π–Ω —Ö–∞—è–≥:\n"
            "Way Academy, Mahatma Gandhi St, 7th floor 705, Galaxy Tower, "
            "Ulaanbaatar, Mongolia."
        ),
    },
    {
        "q_keywords": ["—É—Ç–∞—Å", "—Ö–æ–ª–±–æ–≥–¥–æ—Ö", "contact", "phone", "–∏–º—ç–π–ª", "email"],
        "answer": (
            "‚òé –•–æ–ª–±–æ–≥–¥–æ—Ö —É—Ç–∞—Å: 99201187\n"
            "‚úâ Email: hello@wayconsulting.io\n"
            "–•”©—Ç”©–ª–±”©—Ä–∏–π–Ω —Ç–∞–ª–∞–∞—Ä—Ö –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª—ç–ª, –±“Ø—Ä—Ç–≥—ç–ª–∏–π–Ω –∑–∞–∞–≤—Ä—ã–≥ —ç–¥–≥—ç—ç—Ä —Å—É–≤–≥–∞–∞—Ä "
            "—à—É—É–¥ –∞—Å—É—É–∂ –±–æ–ª–Ω–æ."
        ),
    },
]

# ---------------- –¢–£–°–õ–ê–• –§–£–ù–ö–¶–£–£–î ---------------- #

def match_course_info(user_message: str) -> str | None:
    """–•—ç—Ä—ç–≥–ª—ç–≥—á —Ç–æ–¥–æ—Ä—Ö–æ–π —Ö”©—Ç”©–ª–±”©—Ä –∞—Å—É—É—Å–∞–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞–∞–¥, —Ç–∞–∞—Ä–≤–∞–ª –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª—ç–ª –±—É—Ü–∞–∞–Ω–∞."""
    msg = user_message.lower()
    for c in COURSE_DATA:
        if any(kw in msg for kw in c["keywords"]):
            txt = f"üéì {c['course_name']}\n\n"
            txt += c["description"] + "\n\n"
            txt += f"üë®‚Äçüè´ –ú–∞—Å—Ç–µ—Ä –±–∞–≥—à: {c['teacher']}\n"
            txt += f"‚è≥ –°—É—Ä–≥–∞–ª—Ç—ã–Ω —Ö—É–≥–∞—Ü–∞–∞: {c['duration']}\n"

            # –•—É–≤–∞–∞—Ä—å
            schedule = c.get("schedule") or {}
            if isinstance(schedule, dict):
                for k, v in schedule.items():
                    txt += f"üìÖ {v}\n"
            else:
                txt += f"üìÖ –•—É–≤–∞–∞—Ä—å: {schedule}\n"

            price = c.get("price") or {}
            if any(price.values()):
                txt += "\nüí∞ –¢”©–ª–±”©—Ä:\n"
                if price.get("full"):
                    txt += f"- “Æ–Ω–¥—Å—ç–Ω —Ç”©–ª–±”©—Ä: {price['full']}\n"
                if price.get("discount"):
                    txt += f"- –•”©–Ω–≥”©–ª”©–ª—Ç—Ç—ç–π “Ø–Ω—ç: {price['discount']}\n"
                if price.get("discount_until"):
                    txt += f"- –•”©–Ω–≥”©–ª”©–ª—Ç–∏–π–Ω —Ö—É–≥–∞—Ü–∞–∞: {price['discount_until']}\n"

            payment_options = c.get("payment_options") or []
            if payment_options:
                txt += "\nüü¢ –¢”©–ª–±”©—Ä–∏–π–Ω —É—è–Ω —Ö–∞—Ç–∞–Ω –Ω”©—Ö—Ü”©–ª:\n"
                for p in payment_options:
                    txt += f"- {p}\n"

            if "application_link" in c:
                txt += f"\nüîó ”®—Ä–≥”©–¥”©–ª –∏–ª–≥—ç—ç—Ö –ª–∏–Ω–∫: {c['application_link']}"

            txt += "\n\n–•—ç—Ä—ç–≤ —ç–Ω—ç —Ö”©—Ç”©–ª–±”©—Ä —Ç–∞–Ω–¥ —Ç–æ—Ö–∏—Ä–æ—Ö –±–æ–ª–æ–≤—á —Ç–æ–¥—Ä—É—É–ª–∞—Ö –∞—Å—É—É–ª—Ç –±–∞–π–≤–∞–ª —è–≥ –æ–¥–æ–æ –∞—Å—É—É–≥–∞–∞—Ä–∞–π."
            return txt
    return None


def match_faq(user_message: str) -> str | None:
    """–ï—Ä”©–Ω—Ö–∏–π FAQ –∞—Å—É—É–ª—Ç—Ç–∞–π —Ç–∞–∞—Ä–≤–∞–ª —Ö–∞—Ä–∏—É–≥ –Ω—å –±—É—Ü–∞–∞–Ω–∞."""
    text = user_message.lower()
    for item in FAQ_LIST:
        if any(kw.lower() in text for kw in item["q_keywords"]):
            return item["answer"]
    return None


def generate_ai_reply(user_message: str) -> str:
    """
    1) –≠—Ö–ª—ç—ç–¥ —Ç–æ–¥–æ—Ä—Ö–æ–π —Ö”©—Ç”©–ª–±”©—Ä–∏–π–Ω –∞—Å—É—É–ª—Ç —É—É –≥—ç–¥–≥–∏–π–≥ —à–∞–ª–≥–∞–Ω–∞
    2) –î–∞—Ä–∞–∞ –Ω—å FAQ —à–∞–ª–≥–∞–Ω–∞
    3) –¢–∞–∞—Ä–∞—Ö–≥“Ø–π –±–æ–ª OpenAI LLM-—ç—ç—Ä —É—Ö–∞–∞–ª–∞–≥ —Ö–∞—Ä–∏—É –≥–∞—Ä–≥–∞–Ω–∞
    """

    # 1. –•”©—Ç”©–ª–±”©—Ä–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª
    course_answer = match_course_info(user_message)
    if course_answer:
        return course_answer

    # 2. FAQ
    faq_answer = match_faq(user_message)
    if faq_answer:
        return faq_answer

    # 3. AI —Ö–∞—Ä–∏—É
    system_prompt = """
–¢–∞ Way Academy —Å—É—Ä–≥–∞–ª—Ç—ã–Ω —Ç”©–≤–∏–π–Ω Facebook Page-–∏–π–Ω –∞–ª–±–∞–Ω —ë—Å–Ω—ã AI —Ç—É—Å–ª–∞—Ö.

Business info:
- –ù—ç—Ä: Way Academy
- –¢”©—Ä”©–ª: –°—É—Ä–≥–∞–ª—Ç—ã–Ω —Ç”©–≤ / –æ–Ω–ª–∞–π–Ω –∞–∫–∞–¥–µ–º–∏
- –ë–∞–π—Ä—à–∏–ª: Way Academy, Mahatma Gandhi St, 7th floor 705, Galaxy Tower, Ulaanbaatar, Mongolia
- –•–æ–ª–±–æ–≥–¥–æ—Ö: –£—Ç–∞—Å 99201187, Email hello@wayconsulting.io
- –ì–æ–ª —á–∏–≥–ª—ç–ª: –°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, Data Analyst, IT Business Analyst, AI Agent Developer (Project Zero)

–ê–∫–∞–¥–µ–º–∏–π–Ω –æ–Ω—Ü–ª–æ–≥:
- –•”©–¥”©–ª–º”©—Ä–∏–π–Ω –∑–∞—Ö –∑—ç—ç–ª –¥—ç—ç—Ä—Ö —Ö–∞–º–≥–∏–π–Ω —ç—Ä—ç–ª—Ç—Ç—ç–π —É—Ä —á–∞–¥–≤–∞—Ä—É—É–¥—ã–≥ —Å–∞–ª–±–∞—Ä—ã–Ω —à–∏–ª–¥—ç–≥ –º—ç—Ä–≥—ç–∂–∏–ª—Ç–Ω“Ø“Ø–¥—ç—ç—Å –±–æ–≥–∏–Ω–æ —Ö—É–≥–∞—Ü–∞–∞–Ω–¥ —ç–∑—ç–º—à“Ø“Ø–ª–Ω—ç.
- –ë“Ø—Ö —Ö”©—Ç”©–ª–±”©—Ä –Ω—å —Ö–∏–π–º—ç–ª –æ—é—É–Ω (AI)-–≥ —Ö—ç—Ä—Ö—ç–Ω –∞—à–∏–≥–ª–∞–Ω –±“Ø—Ç—ç—ç–º–∂, –≥“Ø–π—Ü—ç—Ç–≥—ç–ª—ç—ç –Ω—ç–º—ç–≥–¥“Ø“Ø–ª—ç—Ö—ç–¥ —Ç”©–≤–ª”©—Ä—Å”©–Ω.
- Industry integrated learning: –±–æ–¥–∏—Ç –∫–æ–º–ø–∞–Ω–∏—É–¥—ã–Ω —Ç”©—Å”©–ª, –∫–µ–π—Å –¥—ç—ç—Ä —Å—É—É—Ä–∏–ª—Å–∞–Ω —Å—É—Ä–≥–∞–ª—Ç.
- Continuous Development: –¢”©–≥—Å—Å”©–Ω–∏–π –¥–∞—Ä–∞–∞ —á —Å—É—Ä–∞–ª—Ü–∞–≥—á–¥—ã–≥ —Ç–∞—Å—Ä–∞–ª—Ç–≥“Ø–π —Ö”©–≥–∂“Ø“Ø–ª–∂, —à–∏–Ω—ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏, —á–∏–≥ —Ö–∞–Ω–¥–ª–∞–≥—ã–Ω –º—ç–¥—ç—ç–ª–ª—ç—ç—Ä —Ö–∞–Ω–≥–∞–Ω–∞.
- –ë–∞–≥—à –Ω–∞—Ä –Ω—å C-level, —Å–∞–ª–±–∞—Ä—Ç–∞–∞ —Ö“Ø–ª—ç—ç–Ω –∑”©–≤—à”©”©—Ä”©–≥–¥—Å”©–Ω –º—ç—Ä–≥—ç–∂–∏–ª—Ç–Ω“Ø“Ø–¥.

Rules (tone & style):
- –ó”®–í–•”®–ù –º–æ–Ω–≥–æ–ª–æ–æ—Ä —Ö–∞—Ä–∏—É–ª.
- –ù–∞–π—Ä—Å–∞–≥ —á –≥—ç—Å—ç–Ω –±–∞–≥–∞ –∑—ç—Ä—ç–≥ –∑–∞—Ö–∏—Ä–≥–∞–∞—Ç–∞–π, —á–∏–≥–ª“Ø“Ø–ª—Å—ç–Ω ”©–Ω–≥”© –∞—è—Å –∞—à–∏–≥–ª–∞. (–ñ–∏—à—ç—ç –Ω—å: "–≠—Ö–ª—ç—ç–¥ ... —Ö–∏–π–≥—ç—ç—Ä—ç–π", "–¢–∞ –∑–∞–∞–≤–∞–ª ...", "–î–∞—Ä–∞–∞–≥–∏–π–Ω –∞–ª—Ö–∞–º –±–æ–ª ...")
- –ì–æ–ª —Å–∞–Ω–∞–∞–≥ —Ç–æ–≤—á, —à–∏–π–¥–≤—ç—Ä –≥–∞—Ä–≥–∞—Ö—É–π—Ü –±–∞–π–¥–ª–∞–∞—Ä, 2‚Äì5 ”©–≥“Ø“Ø–ª–±—ç—Ä—Ç –±–∞–≥—Ç–∞–∞–Ω —Ö—ç–ª.
- –•—ç—Ä—ç–≤ —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–ª—Ç —Ç–æ–¥–æ—Ä—Ö–æ–π –±–∏—à –±–∞–π–≤–∞–ª, –∑–æ—Ä–∏–ª–≥–æ–æ (–∫–∞—Ä—å–µ—Ä, –±–∏–∑–Ω–µ—Å, —É—Ä —á–∞–¥–≤–∞—Ä) –±–æ–ª–æ–Ω —Å–æ–Ω–∏—Ä—Ö–æ–∂ –±—É–π —Ö”©—Ç”©–ª–±”©—Ä”©”© —ç—Ö–ª—ç—ç–¥ 1‚Äì2 ”©–≥“Ø“Ø–ª–±—ç—Ä—ç—ç—Ä –±–∏—á–∏—Ö–∏–π–≥ –®–ê–ê–†–î.
- –ú—ç–¥—ç—Ö–≥“Ø–π –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –±–∏—Ç–≥–∏–π –∑–æ—Ö–∏–æ. –ë–∞–π—Ö–≥“Ø–π –±–æ–ª: "—è–≥ –æ–¥–æ–æ –Ω–∞–¥–∞–¥ —ç–Ω—ç –º—ç–¥—ç—ç–ª—ç–ª –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞, –º–µ–Ω–µ–∂–µ—Ä—Ç—ç–π —à—É—É–¥ —Ö–æ–ª–±–æ–≥–¥–æ–æ—Ä–æ–π" –≥—ç–∂ —Ö—ç–ª.
- –•—ç—Ä—ç–≤ —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–¥ –∞–ª—å —Ö”©—Ç”©–ª–±”©—Ä —Ç–æ—Ö–∏—Ä–æ—Ö—ã–≥ –∞—Å—É—É–≤–∞–ª, —Ç“Ø“Ø–Ω—ç—ç—Å:
  * –û–¥–æ–æ–≥–∏–π–Ω —Ç“Ø–≤—à–∏–Ω (–∞–Ω—Ö–∞–Ω, –¥—É–Ω–¥, –∞—Ö–∏—Å–∞–Ω)
  * –ó–æ—Ä–∏–ª–≥–æ (–∞–∂–∏–ª–¥ –æ—Ä–æ—Ö, –±–∏–∑–Ω–µ—Å—ç—ç ”©—Å–≥”©—Ö, –º—ç—Ä–≥—ç–∂–∏–ª —Å–æ–ª–∏—Ö –≥—ç—Ö –º—ç—Ç)
  * –•–∏—á—ç—ç–ª–¥ –∑–æ—Ä–∏—É–ª–∂ —á”©–ª”©”©—Ç—ç–π –≥–∞—Ä–≥–∞–∂ —á–∞–¥–∞—Ö —Ü–∞–≥ (–æ—Ä–æ–π, ”©–¥”©—Ä, –∞–º—Ä–∞–ª—Ç—ã–Ω ”©–¥”©—Ä)
  —ç–¥–≥—ç—ç—Ä–∏–π–≥ –Ω—å —Ç–æ–¥—Ä—É—É–ª–∂ –∞–≤–∞–∞–¥, —Ö–∞–º–≥–∏–π–Ω —Ç–æ—Ö–∏—Ä–æ—Ö 1‚Äì2 —Ö”©—Ç”©–ª–±”©—Ä–∏–π–≥ –ù–≠–ì –ú–≠–î–≠–≠–ù–î —Å–∞–Ω–∞–ª –±–æ–ª–≥–æ.
"""

    completion = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": user_message},
        ],
        temperature=0.6,
    )

    return completion.choices[0].message.content.strip()


# ---------------- Messenger —Ä“Ø“Ø –º–µ—Å—Å–µ–∂ –∏–ª–≥—ç—ç—Ö ---------------- #

def send_message(recipient_id: str, text: str) -> None:
    """Facebook Graph API –∞—à–∏–≥–ª–∞–Ω —Ö—ç—Ä—ç–≥–ª—ç–≥—á —Ä“Ø“Ø —Ç–µ–∫—Å—Ç –º–µ—Å—Å–µ–∂ –∏–ª–≥—ç—ç–Ω—ç."""
    url = "https://graph.facebook.com/v24.0/me/messages"

    params = {"access_token": PAGE_ACCESS_TOKEN}

    payload = {
        "recipient": {"id": recipient_id},
        "message": {"text": text},
    }

    response = requests.post(url, params=params, json=payload)
    print("SEND MESSAGE STATUS:", response.status_code, response.text)


# ---------------- Webhook VERIFY (GET) ---------------- #

@app.get("/webhook")
def verify_webhook():
    """
    Facebook-—ç—ç—Å —ç—Ö–Ω–∏–π —É–¥–∞–∞ webhook —à–∞–ª–≥–∞—Ö GET —Ö“Ø—Å—ç–ª—Ç –∏—Ä—ç—Ö—ç–¥
    VERIFY_TOKEN-–æ–æ –∞—à–∏–≥–ª–∞–∞–¥ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–Ω–∞.
    """
    mode = request.args.get("hub.mode")
    token = request.args.get("hub.verify_token")
    challenge = request.args.get("hub.challenge")

    if mode == "subscribe" and token == VERIFY_TOKEN:
        print("WEBHOOK VERIFIED!")
        return challenge, 200

    print("WEBHOOK VERIFICATION FAILED")
    return "Verification failed", 403


# ---------------- Webhook EVENT (POST) ---------------- #

@app.post("/webhook")
def handle_webhook():
    """
    Messenger-—ç—ç—Å –∏—Ä—Å—ç–Ω –±“Ø—Ö event (–º–µ—Å—Å–µ–∂, –ø–æ—Å—Çback –≥.–º) —ç–Ω–¥ –æ—Ä–∂ –∏—Ä–Ω—ç.
    –û–¥–æ–æ–≥–æ–æ—Ä –∑”©–≤—Ö”©–Ω text message –¥—ç—ç—Ä –∞–∂–∏–ª–ª–∞–Ω–∞.
    """
    data = request.get_json()
    print("===== NEW EVENT =====")
    print(data)

    if data.get("object") != "page":
        return "Ignored", 404

    for entry in data.get("entry", []):
        for event in entry.get("messaging", []):
            if "message" in event:
                sender_id = event["sender"]["id"]
                message = event["message"]

                # Echo (”©”©—Ä–∏–π–Ω —è–≤—É—É–ª—Å–∞–Ω –º–µ—Å—Å–µ–∂) –±–∞–π–≤–∞–ª –∞–ª–≥–∞—Å–Ω–∞
                if message.get("is_echo"):
                    continue

                user_text = message.get("text", "")
                if not user_text:
                    # –∑—É—Ä–≥—É—É–¥, —Ñ–∞–π–ª –≥.–º –∏—Ä–≤—ç–ª –æ–¥–æ–æ—Ö–æ–Ω–¥–æ–æ –∞–ª–≥–∞—Å–Ω–∞
                    continue

                # AI / COURSE / FAQ —Ö–∞—Ä–∏—É –≥–∞—Ä–≥–∞—Ö
                reply_text = generate_ai_reply(user_text)

                # Messenger —Ä“Ø“Ø –±—É—Ü–∞–∞–∂ –∏–ª–≥—ç—ç—Ö
                send_message(sender_id, reply_text)

    return "EVENT_RECEIVED", 200


# ---------------- Main ---------------- #

if __name__ == "__main__":
    app.run(port=5000, debug=True)
