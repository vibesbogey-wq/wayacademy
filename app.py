import os
import requests
from flask import Flask, request, jsonify
from dotenv import load_dotenv
from openai import OpenAI

# ---------------- ENV –ê–ß–ê–ê–õ–õ–ê–• ----------------
load_dotenv()

PAGE_ACCESS_TOKEN = os.getenv("PAGE_ACCESS_TOKEN")
VERIFY_TOKEN = os.getenv("VERIFY_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

if not OPENAI_API_KEY:
    raise RuntimeError("OPENAI_API_KEY environment variable –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞!")

client = OpenAI(api_key=OPENAI_API_KEY)
app = Flask(__name__)

# ---------------- –•”®–¢”®–õ–ë”®–†“Æ“Æ–î–ò–ô–ù –î–ê–¢–ê ----------------
COURSE_DATA = [
    {
        "course_name": "–°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –î–∏–∂–∏—Ç–∞–ª –ú–∞—Ä–∫–µ—Ç–µ—Ä",
        "keywords": [
            "—Å—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–µ—Ä", "digital marketer", "–¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥",
            "–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω —Ö”©—Ç”©–ª–±”©—Ä", "–º–∞—Ä–∫–µ—Ç–µ—Ä", "facebook —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞",
            "instagram —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞", "seo", "blue ocean"
        ],
        "description": (
            "–¢–∞–∞–º–∞–≥–ª–∞—Ö–∞–∞ –±–æ–ª—å, “Ø—Ä –¥“Ø–Ω–≥ —É–¥–∏—Ä–¥! –≠–Ω—ç —Ö”©—Ç”©–ª–±”©—Ä –Ω—å –∫–∞—Ä—å–µ—Ä–∞–∞ —ç—Ö–ª“Ø“Ø–ª—ç—Ö, "
            "–±–∏–∑–Ω–µ—Å—ç—ç ”©—Å–≥”©—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —Ö“Ø–Ω –±“Ø—Ä—Ç –∑–æ—Ä–∏—É–ª–∞–≥–¥—Å–∞–Ω.\n\n"
            "–ë–∏–¥ —Ç–∞–Ω–¥ –∑”©–≤—Ö”©–Ω 'Boost' –¥–∞—Ä–∞—Ö—ã–≥ –∑–∞–∞—Ö–≥“Ø–π. –•–∞—Ä–∏–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –∞—Ö–∏—Å–∞–Ω —Ç“Ø–≤—à–Ω–∏–π —à–∏–Ω–∂–∏–ª–≥—ç—ç, "
            "Blue Ocean Strategy, —à–∏–ª–¥—ç–≥ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏ –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö —É—Ä —á–∞–¥–≤–∞—Ä, "
            "Facebook / Instagram —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞–Ω—ã –∞—Ö–∏—Å–∞–Ω —Ç“Ø–≤—à–Ω–∏–π —Ç–µ—Ö–Ω–∏–∫“Ø“Ø–¥, “Ø–Ω—ç —Ü—ç–Ω—Ç—ç–π –∫–æ–Ω—Ç–µ–Ω—Ç "
            "–±“Ø—Ç—ç—ç—Ö —É—Ä–ª–∞–≥–∞–∞—Å —ç—Ö–ª—ç—ç–¥ SEO —Ö“Ø—Ä—Ç—ç–ª –¥–∏–∂–∏—Ç–∞–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω —Ü–æ–≥—Ü —É—Ä —á–∞–¥–≤–∞—Ä—ã–≥ —ç–∑—ç–º—à“Ø“Ø–ª–Ω—ç.\n\n"
            "–¢”©–≥—Å”©”©–¥:\n"
            "‚Ä¢ Meta –æ–ª–æ–Ω —É–ª—Å—ã–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç + Blockchain –±–∞—Ç–∞–ª–≥–∞–∞–∂—Å–∞–Ω –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç\n"
            "‚Ä¢ –ë–æ–¥–∏—Ç —Ç”©—Å”©–ª –¥—ç—ç—Ä –∞–∂–∏–ª–ª–∞–∂ –æ—Ä–ª–æ–≥–æ –æ–ª–∂ —ç—Ö–ª—ç—Ö –±–æ–ª–æ–º–∂"
        ),
        "teacher": "–≠. –≠–Ω—Ö–∑–∞—è–∞ (Way Academy-–∏–π–Ω “Ø“Ø—Å–≥—ç–Ω –±–∞–π–≥—É—É–ª–∞–≥—á, CEO)",
        "duration": "5 —Å–∞—Ä (7 —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)",
        "schedule": {
            "evening": "–û—Ä–æ–π–Ω –∞–Ω–≥–∏: –ú—è–≥–º–∞—Ä, –ü“Ø—Ä—ç–≤ 18:00‚Äì21:00",
            "daytime": "”®–¥—Ä–∏–π–Ω –∞–Ω–≥–∏: –õ—Ö–∞–≥–≤–∞, –ë—è–º–±–∞ 14:00‚Äì17:00"
        },
        "price": {
            "full": None,
            "discount": None,
            "discount_until": None
        },
        "payment_options": [
            "–¢”©–ª–±”©—Ä–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –º–µ–Ω–µ–∂–µ—Ä—Ç—ç–π —Ö–æ–ª–±–æ–≥–¥–æ–Ω –ª–∞–≤–ª–∞–Ω–∞ —É—É. (99201187)"
        ]
    },
    {
        "course_name": "Data Analyst",
        "keywords": [
            "data analyst", "–¥–∞—Ç–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫", "”©–≥”©–≥–¥–ª–∏–π–Ω —à–∏–Ω–∂—ç—ç—á",
            "”©–≥”©–≥–¥”©–ª", "–∞–Ω–∞–ª–∏—Å—Ç", "python", "google —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
        ],
        "description": (
            "”®–≥”©–≥–¥–ª–∏–π–Ω —à–∏–Ω–∂—ç—ç—á–∏–π–Ω –º—ç—Ä–≥—ç–∂–∏–ª —ç–∑—ç–º—à“Ø“Ø–ª—ç—Ö 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä—Ç–∞–π —Ö”©—Ç”©–ª–±”©—Ä.\n\n"
            "‚Ä¢ –û–ª–æ–Ω —É–ª—Å–∞–¥ –∑”©–≤—à”©”©—Ä”©–≥–¥”©—Ö Google-–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±–æ–ª–æ–Ω –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ö–æ—Å–æ–ª—Å–æ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—Ç–∞–π\n"
            "‚Ä¢ ”®–≥”©–≥–¥”©–ª –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∂ —à–∏–Ω–∂–ª—ç—Ö, “Ø—Ä –¥“Ø–Ω–≥ —Ç–∞–π–ª–∞–≥–Ω–∞—Ö –∞—Ä–≥–∞—á–ª–∞–ª—É—É–¥—ã–≥ —Å—É—Ä–∞–ª—Ü–∞–Ω–∞\n"
            "‚Ä¢ Python –ø—Ä–æ–≥—Ä–∞–º–º –¥—ç—ç—Ä –¥–∞—Ç–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏–π–Ω –∞—Ö–∏—Å–∞–Ω —Ç“Ø–≤—à–Ω–∏–π —Ö—ç—Ä—ç–≥—Å–ª“Ø“Ø–¥–∏–π–≥ –ø—Ä–∞–∫—Ç–∏–∫—Ç –∞—à–∏–≥–ª–∞–∂ —Å—É—Ä–Ω–∞\n"
            "‚Ä¢ –¢“Ø–Ω—à –∫–æ–º–ø–∞–Ω–∏—É–¥—ã–Ω —Ç”©—Å”©–ª –¥—ç—ç—Ä –¥–∞–¥–ª–∞–≥–∞ —Ö–∏–π–∂, —Ç”©–≥—Å”©”©–¥ —à—É—É–¥ –∞–∂–ª—ã–Ω –±–∞–π—Ä–∞–Ω–¥ –∑—É—É—á–ª—É—É–ª–∞—Ö –±–æ–ª–æ–º–∂—Ç–æ–π\n\n"
            "”®–≥”©–≥–¥”©–ª–¥ —Å—É—É—Ä–∏–ª—Å–∞–Ω —à–∏–π–¥–≤—ç—Ä –≥–∞—Ä–≥–∞–∂, –±–∏–∑–Ω–µ—Å–∏–π–Ω –∞–º–∂–∏–ª—Ç—ã–≥ –¥—ç–º–∂–∏—Ö —á–∞–¥–≤–∞—Ä–∞–∞ —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö–∏–π–≥ "
            "—Ö“Ø—Å—ç–∂ –±–∞–π–≤–∞–ª —ç–Ω—ç —Ö”©—Ç”©–ª–±”©—Ä —Ç–∞–Ω–¥ –∑–æ—Ä–∏—É–ª–∞–≥–¥—Å–∞–Ω."
        ),
        "teacher": "–ß. –ê–ª—Ç–∞–Ω-”®–ª–∑–∏–π (Data Analyst-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à)",
        "duration": "4 —Å–∞—Ä",
        "schedule": {
            "weekend": "–ê–º—Ä–∞–ª—Ç—ã–Ω ”©–¥—Ä–∏–π–Ω –∞–Ω–≥–∏: –ë—è–º–±–∞, –ù—è–º 11:00‚Äì14:00 (–¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)",
            "weekday": "–ê–∂–ª—ã–Ω ”©–¥—Ä–∏–π–Ω –∞–Ω–≥–∏: –î–∞–≤–∞–∞, –õ—Ö–∞–≥–≤–∞ 19:00‚Äì22:00 (–¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)"
        },
        "price": {
            "full": "5,842,000‚ÇÆ",
            "discount": "5,242,000‚ÇÆ",
            "discount_until": "8 —Å–∞—Ä—ã–Ω 31 —Ö“Ø—Ä—Ç—ç–ª (Final Chance)"
        },
        "payment_options": [
            "–£—Ä—å–¥—á–∏–ª–≥–∞–∞ 500,000‚Äì1,500,000‚ÇÆ —Ç”©–ª”©”©–¥ “Ø–ª–¥—Å—ç–Ω —Ç”©–ª–±”©—Ä”©”© 2025/12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª —Å–∞—Ä –±“Ø—Ä —Ö—É–≤–∞–∞–∂ —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π.",
            "PocketZero-–æ–æ—Ä 12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª—Ö —Ö“Ø“Ø–≥“Ø–π, —à–∏–º—Ç–≥—ç–ª–≥“Ø–π —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π."
        ]
    },
    {
        "course_name": "IT Business Analyst",
        "keywords": [
            "it business analyst", "–∏—Ç –±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Å—Ç", "–±–∏–∑–Ω–µ—Å –∞–Ω–∞–ª–∏—Å—Ç",
            "business analyst", "–±–∞ –±–∏–∑–Ω–µ—Å —à–∏–Ω–∂—ç—ç—á", "it –±–∞"
        ],
        "description": (
            "IT Business Analyst –º—ç—Ä–≥—ç–∂–∏–ª —ç–∑—ç–º—à“Ø“Ø–ª—ç—Ö 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä—Ç–∞–π —Ö”©—Ç”©–ª–±”©—Ä.\n\n"
            "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏ –±–æ–ª–æ–Ω –±–∏–∑–Ω–µ—Å–∏–π–Ω –º—ç–¥–ª—ç–≥, —É—Ä —á–∞–¥–≤–∞—Ä—ã–≥ —Ü–æ–≥—Ü–ª–æ–æ—Å–æ–Ω –º—ç—Ä–≥—ç–∂–∏–ª—Ç—ç–Ω –±–æ–ª–∂ "
            "—Ö”©–¥”©–ª–º”©—Ä–∏–π–Ω –∑–∞—Ö –∑—ç—ç–ª–¥ –¥–∞–≤–∞–º–≥–∞–π–ª–Ω–∞.\n\n"
            "‚Ä¢ –ë–∏–∑–Ω–µ—Å–∏–π–Ω “Ø–π–ª –∞–∂–∏–ª–ª–∞–≥–∞–∞–≥ –æ–Ω–æ–≤—á—Ç–æ–π –±–æ–ª–≥–æ—Ö, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω —à–∏–π–¥—ç–ª –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö —á–∞–¥–≤–∞—Ä —ç–∑—ç–º—à–∏–Ω—ç\n"
            "‚Ä¢ –ü—Ä–æ—Ü–µ—Å—Å—ã–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç, —Ç”©—Å–ª–∏–π–Ω –º–µ–Ω–µ–∂–º–µ–Ω—Ç–∏–π–Ω –∞—Ä–≥–∞ –±–∞—Ä–∏–ª–¥ —Å—É—Ä–∞–ª—Ü–∞–Ω–∞\n"
            "‚Ä¢ –ú–æ–Ω–≥–æ–ª—ã–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω –∫–æ–º–ø–∞–Ω–∏—É–¥—ã–Ω –±–æ–¥–∏—Ç —Ç”©—Å”©–ª –¥—ç—ç—Ä –ø—Ä–∞–∫—Ç–∏–∫ —Ö–∏—á—ç—ç–ª —Ö–∏–π–Ω—ç\n"
            "‚Ä¢ –ú—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—Ç–∞–π, 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä–∞–Ω–¥ –±—ç–ª—Ç–≥—ç–≥–¥—ç–Ω—ç"
        ),
        "teacher": "–¢. –ë–∞—Ç–∑–∞—è–∞ (–¢–µ—Ö–Ω–æ–ª–æ–≥–∏ —Ö–∞—Ä–∏—É—Ü—Å–∞–Ω –∑–∞—Ö–∏—Ä–∞–ª, –º–∞—Å—Ç–µ—Ä –±–∞–≥—à)",
        "duration": "3 —Å–∞—Ä",
        "schedule": {
            "weekday": "–ú—è–≥–º–∞—Ä, –ü“Ø—Ä—ç–≤ 19:00‚Äì22:00 (–¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥—Ç 2 —É–¥–∞–∞)"
        },
        "price": {
            "full": None,
            "discount": None,
            "discount_until": None
        },
        "payment_options": [
            "–¢”©–ª–±”©—Ä, —Ö”©–Ω–≥”©–ª”©–ª—Ç–∏–π–Ω —Ç–∞–ª–∞–∞—Ä –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π–≥ –º–µ–Ω–µ–∂–µ—Ä—Ç—ç–π —Ö–æ–ª–±–æ–≥–¥–æ–Ω –ª–∞–≤–ª–∞–Ω–∞ —É—É. (99201187)"
        ]
    },
    {
        "course_name": "Project Zero: AI Agent Developer (Code the Future)",
        "keywords": [
            "project zero", "ai agent", "ai agent developer", "code the future",
            "agent developer", "ai developer", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä", "–¥–∏–∂–∏—Ç–∞–ª –∞–∂–∏–ª—Ç–∞–Ω"
        ],
        "description": (
            "Project Zero: Code the Future –Ω—å —Ç–∞–Ω—ã–≥ AI —Ö—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å AI –±“Ø—Ç—ç—ç–≥—á '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä' –±–æ–ª–≥–æ–Ω —Ö—É–≤–∏—Ä–≥–∞—Ö "
            "–æ–Ω—Ü–≥–æ–π 4 —Å–∞—Ä—ã–Ω –∞—è–ª–∞–ª —é–º.\n\n"
            "–¢–∞ —ç–Ω—ç –∞—è–ª–ª—ã–≥ –ú–æ–Ω–≥–æ–ª—ã–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π–Ω —Å–∞–ª–±–∞—Ä—ã–Ω —à–∏–ª–¥—ç–≥ —ç–∫—Å–ø–µ—Ä—Ç –ó. –ë–∞—Ç–∑–∞—è–∞-—Å —à—É—É–¥ "
            "—Å—É—Ä–∞–ª—Ü–∞–Ω —ç—Ö–ª“Ø“Ø–ª–Ω—ç. –¢–∞ —É—Ö–∞–∞–ª–∞–≥ —á–∞—Ç–±–æ—Ç, –¥–∞—Ç–∞ –∞–Ω–∞–ª–∏—Å—Ç –∞–≥–µ–Ω—Ç –∑—ç—Ä—ç–≥ –±–æ–¥–∏—Ç –∞—Å—É—É–¥–∞–ª —à–∏–π–¥–¥—ç–≥ "
            "'–¥–∏–∂–∏—Ç–∞–ª –∞–∂–∏–ª—Ç–∞–Ω'-—É—É–¥—ã–≥ ”©”©—Ä–∏–π–Ω –≥–∞—Ä–∞–∞—Ä –±“Ø—Ç—ç—ç—Ö –±–æ–ª–Ω–æ.\n\n"
            "–≠–ª—Å—ç–ª—Ç –Ω—å —Ç—É—Å–≥–∞–π, –∑”©–≤—Ö”©–Ω ”©—Ä–≥”©–¥–ª”©”©—Ä, —Ü”©”©–Ω —Ç–æ–æ–Ω—ã –∞–Ω—Ö–¥–∞–≥—á–¥—ã–≥ —Å–æ–Ω–≥–æ–Ω —à–∞–ª–≥–∞—Ä—É—É–ª–¥–∞–≥."
        ),
        "teacher": "–ó. –ë–∞—Ç–∑–∞—è–∞ (Project Zero, IT Business Analyst-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à)",
        "duration": "4 —Å–∞—Ä",
        "schedule": {
            "info": "–•—É–≤–∞–∞—Ä–∏–π–≥ ”©—Ä–≥”©–¥”©–ª –±–∞—Ç–ª–∞–≥–¥—Å–∞–Ω—ã –¥–∞—Ä–∞–∞ —ç—Ü—ç—Å–ª—ç–Ω —Ç–∞–Ω–∏–ª—Ü—É—É–ª–Ω–∞."
        },
        "price": {
            "full": "7,448,000‚ÇÆ",
            "discount": "6,640,000‚ÇÆ",
            "discount_until": "9 —Å–∞—Ä—ã–Ω 14 —Ö“Ø—Ä—Ç—ç–ª (Final Chance)"
        },
        "payment_options": [
            "–£—Ä—å–¥—á–∏–ª–≥–∞–∞ 1,000,000‚ÇÆ —Ç”©–ª”©”©–¥ “Ø–ª–¥—Å—ç–Ω —Ç”©–ª–±”©—Ä”©”© 2025/12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª —É—è–Ω —Ö–∞—Ç–∞–Ω —Ö—É–≤–∞–∞–∂ —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π.",
            "PocketZero-–æ–æ—Ä 12 —Å–∞—Ä —Ö“Ø—Ä—Ç—ç–ª—Ö —Ö“Ø“Ø–≥“Ø–π, —à–∏–º—Ç–≥—ç–ª–≥“Ø–π —Ç”©–ª”©—Ö –±–æ–ª–æ–º–∂—Ç–æ–π."
        ],
        "application_link": "https://forms.gle/qgyNEKecuJ22f5mYA"
    },
]

# ---------------- FAQ ----------------
FAQ_LIST = [
    {
        "q_keywords": ["—Ö”©—Ç”©–ª–±”©—Ä", "—è–º–∞—Ä —Ö”©—Ç”©–ª–±”©—Ä", "course", "program", "programs", "—è–º–∞—Ä —è–º–∞—Ä –∞–Ω–≥–∏"],
        "answer": (
            "üéì Way Academy-–¥ –æ–¥–æ–æ–≥–æ–æ—Ä —ç–¥–≥—ç—ç—Ä —Ö”©—Ç”©–ª–±”©—Ä“Ø“Ø–¥ —è–≤–∞–≥–¥–∞–∂ –±–∞–π–Ω–∞:\n\n"
            "1Ô∏è‚É£ –°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –î–∏–∂–∏—Ç–∞–ª –ú–∞—Ä–∫–µ—Ç–µ—Ä\n"
            "2Ô∏è‚É£ Data Analyst\n"
            "3Ô∏è‚É£ IT Business Analyst\n"
            "4Ô∏è‚É£ Project Zero: AI Agent Developer\n\n"
            "–ê–ª—å –Ω—å —Å–æ–Ω–∏—Ä—Ö–æ–∂ –±–∞–π–Ω–∞ –≤—ç? –•”©—Ç”©–ª–±”©—Ä–∏–π–Ω –Ω—ç—Ä–∏–π–≥ –ª –±–∏—á—ç—ç—Ä—ç–π, –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —Ç–∞–Ω–∏–ª—Ü—É—É–ª—ä—è üòä"
        ),
    },
    {
        "q_keywords": ["–æ–Ω—Ü–ª–æ–≥", "—è–ª–≥–∞—Ä–∞–ª", "way academy —é—É –Ω—å", "—è–∞–≥–∞–∞–¥ way academy"],
        "answer": (
            "Way Academy –Ω—å —Ö”©–¥”©–ª–º”©—Ä–∏–π–Ω –∑–∞—Ö –∑—ç—ç–ª –¥—ç—ç—Ä —è–≥ –æ–¥–æ–æ —Ö–∞–º–≥–∏–π–Ω —ç—Ä—ç–ª—Ç—Ç—ç–π –±–∞–π–≥–∞–∞ –º—ç—Ä–≥—ç–∂–ª“Ø“Ø–¥–∏–π–≥ "
            "–±–æ–≥–∏–Ω–æ —Ö—É–≥–∞—Ü–∞–∞–Ω–¥, —á–∞–Ω–∞—Ä—Ç–∞–π —ç–∑—ç–º—à“Ø“Ø–ª–¥—ç–≥. –ë–∏–¥–Ω–∏–π –≥–æ–ª –æ–Ω—Ü–ª–æ–≥ –±–æ–ª:\n\n"
            "‚ú® –°–∞–ª–±–∞—Ä—ã–Ω —à–∏–ª–¥—ç–≥ —ç–∫—Å–ø–µ—Ä—Ç“Ø“Ø–¥—ç—ç—Å —à—É—É–¥ —Å—É—Ä–∞–ª—Ü–∞–Ω–∞\n"
            "‚ú® –ë–æ–¥–∏—Ç –∫—ç–π—Å, —Ç”©—Å”©–ª –¥—ç—ç—Ä –∞–∂–∏–ª–ª–∞–Ω–∞\n"
            "‚ú® –¢”©–≥—Å—Å”©–Ω–∏–π –¥–∞—Ä–∞–∞ —á —Ç–∞—Å—Ä–∞–ª—Ç–≥“Ø–π –¥—ç–º–∂–ª—ç–≥ “Ø–∑“Ø“Ø–ª–Ω—ç\n"
            "‚ú® AI-–≥ –±“Ø—Ö —Ö”©—Ç”©–ª–±”©—Ä—Ç –∏–¥—ç–≤—Ö—Ç—ç–π –Ω—ç–≤—Ç—Ä“Ø“Ø–ª—Å—ç–Ω\n\n"
            "–¢–æ–≤—á—Ö–æ–Ω–¥–æ–æ, —Ç–∞ ”©”©—Ä–∏–π–Ω –∞–ª—Ç–∞–Ω —Ü–∞–≥–∞–∞ “Ø–Ω—ç—Ö—ç—ç—Ä “Ø—Ä –¥“Ø–Ω—Ç—ç–π —Ö”©—Ä”©–Ω–≥”© –æ—Ä—É—É–ª–∞–ª—Ç –±–æ–ª–≥–æ–Ω–æ üí™"
        ),
    },
    {
        "q_keywords": ["—Ö–∏–π–º—ç–ª –æ—é—É–Ω", "ai", "artificial intelligence", "—Ö–∞–∞–Ω–∞ ai", "ai –∞—à–∏–≥–ª–∞–¥–∞–≥ —É—É"],
        "answer": (
            "–¢–∏–π–º —ç—ç! ü§ñ –ú–∞–Ω–∞–π –±“Ø—Ö —Ö”©—Ç”©–ª–±”©—Ä—Ç AI-–≥ —Ö—ç—Ä—Ö—ç–Ω –∞—à–∏–≥–ª–∞–∂ —Ç–∞–Ω—ã –∞–∂–∏–ª, –±“Ø—Ç—ç—ç–º–∂–∏–π–≥ "
            "—Ö—ç–¥—ç–Ω –¥–∞—Ö–∏–Ω –Ω—ç–º—ç–≥–¥“Ø“Ø–ª—ç—Ö–∏–π–≥ –∑–∞–∞–¥–∞–≥.\n\n"
            "–ë–∞—Å –º–∞–Ω–∞–π —Å—É—Ä–≥–∞–ª—Ç—ã–Ω —Å–∏—Å—Ç–µ–º ”©”©—Ä”©”© AI –¥—ç—ç—Ä —Å—É—É—Ä–∏–ª–¥–∞–≥ –±”©–≥”©”©–¥ —Ç–∞ —Ö—ç—Ä—Ö—ç–Ω "
            "—Å—É—Ä–∞–ª—Ü–∞–∂ –±–∞–π–≥–∞–∞–≥ —à–∏–Ω–∂–∏–ª–∂, —Ç–∞–Ω–¥ —Ö–∞–º–≥–∏–π–Ω —Ç–æ—Ö–∏—Ä—Å–æ–Ω –∑”©–≤–ª”©–º–∂ ”©–≥–¥”©–≥.\n\n"
            "AI-–≥ –∞—à–∏–≥–ª–∞–∂ –º—ç–¥–¥—ç–≥ —Ö“Ø–Ω –±–æ–ª–æ—Ö–æ–æ—Ä –±–æ–ª –∑”©–≤ –≥–∞–∑–∞—Ä—Ç –∏—Ä–ª—ç—ç üòâ"
        ),
    },
    {
        "q_keywords": ["–±–∞–≥—à", "teacher", "–±–∞–≥—à –Ω–∞—Ä", "mentors", "—ç–∫—Å–ø–µ—Ä—Ç"],
        "answer": (
            "–ú–∞–Ω–∞–π –±–∞–≥—à –Ω–∞—Ä –±–æ–ª —Å–∞–ª–±–∞—Ä—Ç–∞–∞ –∂–∏–Ω—Ö—ç–Ω—ç —ç–∫—Å–ø–µ—Ä—Ç“Ø“Ø–¥ üåü\n\n"
            "üë®‚Äçüíº –¢. –ë–∞—Ç–∑–∞—è–∞ ‚Äî —Ö—ç–¥ —Ö—ç–¥—ç–Ω –∫–æ–º–ø–∞–Ω–∏–π–Ω CTO, Project Zero –±–æ–ª–æ–Ω IT BA-–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à\n"
            "üë®‚Äçüíº –ß. –ê–ª—Ç–∞–Ω-”®–ª–∑–∏–π ‚Äî Ard Financial Group-–∏–π–Ω Chief Data Officer, Data Analyst –º–∞—Å—Ç–µ—Ä –±–∞–≥—à\n"
            "üë®‚Äçüíº –≠. –≠–Ω—Ö–∑–∞—è–∞ ‚Äî Way Academy “Ø“Ø—Å–≥—ç–Ω –±–∞–π–≥—É—É–ª–∞–≥—á, CEO, –°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –î–∏–∂–∏—Ç–∞–ª –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–∏–π–Ω –º–∞—Å—Ç–µ—Ä –±–∞–≥—à\n\n"
            "–¢—ç–¥ –±–æ–¥–∏—Ç –±–∏–∑–Ω–µ—Å–∏–π–Ω —Ç—É—Ä—à–ª–∞–≥–∞–∞—Ä–∞–∞ —Ö—É–≤–∞–∞–ª—Ü–¥–∞–≥ –Ω—å —Ö–∞–º–≥–∏–π–Ω —Ç–æ–º –¥–∞–≤—É—É —Ç–∞–ª!"
        ),
    },
    {
        "q_keywords": ["—Ü–∞–≥", "–∞–∂–∏–ª–ª–∞—Ö —Ü–∞–≥", "—Ö—ç–∑—ç—ç –Ω—ç—ç–ª—Ç—Ç—ç–π", "schedule", "—Ö—É–≤–∞–∞—Ä—å", "working hours", "open"],
        "answer": (
            "üïê –ú–∞–Ω–∞–π –∞–∂–∏–ª–ª–∞—Ö —Ü–∞–≥:\n\n"
            "–ê–∂–ª—ã–Ω ”©–¥”©—Ä: 10:00‚Äì20:00\n"
            "–ê–º—Ä–∞–ª—Ç—ã–Ω ”©–¥”©—Ä (–ë—è–º–±–∞, –ù—è–º): 11:00‚Äì18:00\n\n"
            "–•”©—Ç”©–ª–±”©—Ä –±“Ø—Ä ”©”©—Ä ”©”©—Ä —Ö—É–≤–∞–∞—Ä—å—Ç–∞–π –±–∞–π–¥–∞–≥. –°–æ–Ω–∏—Ä—Ö–æ–∂ –±—É–π —Ö”©—Ç”©–ª–±”©—Ä–∏–π–Ω –Ω—ç—Ä–∏–π–≥ "
            "–ª –±–∏—á—ç—ç—Ä—ç–π, —Ç—ç—Ä —Ö”©—Ç”©–ª–±”©—Ä–∏–π–Ω —è–≥ —Ö—É–≤–∞–∞—Ä–∏–π–≥ —Ö—ç–ª—å–µ üòä"
        ),
    },
    {
        "q_keywords": ["—Ö–∞—è–≥", "–±–∞–π—Ä—à–∏–ª", "location", "address", "—Ö–∞–∞–Ω–∞ –±–∞–π–¥–∞–≥"],
        "answer": (
            "üìç –ú–∞–Ω–∞–π —Ö–∞—è–≥:\n\n"
            "Way Academy\n"
            "Galaxy Tower, 7 –¥–∞–≤—Ö–∞—Ä, 705 —Ç–æ–æ—Ç\n"
            "–ú–∞—Ö–∞—Ç–º–∞ –ì–∞–Ω–¥–∏ –≥—É–¥–∞–º–∂\n"
            "–£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä, –ú–æ–Ω–≥–æ–ª –£–ª—Å\n\n"
            "–•–∞–º–≥–∏–π–Ω –æ–π—Ä –æ—Ä—Ü –Ω—å Galaxy Tower-–∏–π–Ω –∞—Ä–¥ —Ç–∞–ª–∞–∞—Å –±–∞–π–¥–∞–≥. "
            "–•—ç—Ä—ç–≤ –æ–ª–¥–æ—Ö–≥“Ø–π –±–æ–ª 99201187 —Ä—É—É –∑–∞–ª–≥–∞–∞—Ä–∞–π, —Ö“Ø—Ä–≥—ç–∂ ”©–≥—å–µ üòä"
        ),
    },
    {
        "q_keywords": ["—É—Ç–∞—Å", "—Ö–æ–ª–±–æ–≥–¥–æ—Ö", "contact", "phone", "–∏–º—ç–π–ª", "email"],
        "answer": (
            "üìû –•–æ–ª–±–æ–≥–¥–æ—Ö –º—ç–¥—ç—ç–ª—ç–ª:\n\n"
            "–£—Ç–∞—Å: 99201187\n"
            "Email: hello@wayconsulting.io\n\n"
            "–ê—Å—É—É—Ö –∑“Ø–π–ª –±–∞–π–≤–∞–ª —è–≥ –æ–¥–æ–æ –∑–∞–ª–≥–∞–∞—Ä–∞–π —ç—Å–≤—ç–ª –∏–º—ç–π–ª –∏–ª–≥—ç—ç–≥—ç—ç—Ä—ç–π. "
            "–ë–∏–¥ —Ç–∞–Ω–¥ ”©–¥—Ä–∏–π–Ω 24 —Ü–∞–≥—Ç —Ö–∞—Ä–∏—É–ª–∞—Ö –≥—ç–∂ —Ö–∏—á—ç—ç–¥—ç–≥ üí¨"
        ),
    },
]

# ---------------- –¢–£–°–õ–ê–• –§–£–ù–ö–¶–£–£–î ----------------

def match_course_info(user_message: str) -> str | None:
    """–•”©—Ç”©–ª–±”©—Ä–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª –æ–ª–æ—Ö"""
    msg = user_message.lower()
    for c in COURSE_DATA:
        if any(kw in msg for kw in c["keywords"]):
            txt = f"üéì {c['course_name']}\n\n"
            txt += c["description"] + "\n\n"
            txt += f"üë®‚Äçüè´ –ú–∞—Å—Ç–µ—Ä –±–∞–≥—à: {c['teacher']}\n"
            txt += f"‚è≥ –•—É–≥–∞—Ü–∞–∞: {c['duration']}\n"

            schedule = c.get("schedule") or {}
            if isinstance(schedule, dict):
                for k, v in schedule.items():
                    txt += f"üìÖ {v}\n"
            else:
                txt += f"üìÖ {schedule}\n"

            price = c.get("price") or {}
            if any(price.values()):
                txt += "\nüí∞ –¢”©–ª–±”©—Ä:\n"
                if price.get("full"):
                    txt += f"  ‚Ä¢ “Æ–Ω–¥—Å—ç–Ω: {price['full']}\n"
                if price.get("discount"):
                    txt += f"  ‚Ä¢ –•”©–Ω–≥”©–ª”©–ª—Ç—Ç—ç–π: {price['discount']}\n"
                if price.get("discount_until"):
                    txt += f"  ‚Ä¢ –•—É–≥–∞—Ü–∞–∞: {price['discount_until']}\n"

            payment_options = c.get("payment_options") or []
            if payment_options:
                txt += "\nüí≥ –¢”©–ª–±”©—Ä–∏–π–Ω —É—è–Ω —Ö–∞—Ç–∞–Ω –Ω”©—Ö—Ü”©–ª:\n"
                for p in payment_options:
                    txt += f"  ‚Ä¢ {p}\n"

            if "application_link" in c:
                txt += f"\nüîó ”®—Ä–≥”©–¥”©–ª –∏–ª–≥—ç—ç—Ö: {c['application_link']}\n"

            return txt
    return None


def match_faq(user_message: str) -> str | None:
    """FAQ —Ö–∞—Ä–∏—É –æ–ª–æ—Ö"""
    text = user_message.lower()
    for item in FAQ_LIST:
        if any(kw.lower() in text for kw in item["q_keywords"]):
            return item["answer"]
    return None


def generate_ai_reply(user_message: str, user_context: dict = None) -> str:
    """
    AI —Ö–∞—Ä–∏—É “Ø“Ø—Å–≥—ç—Ö - —Ö”©—Ç”©–ª–±”©—Ä, FAQ, OpenAI –¥–∞—Ä–∞–∞–ª–ª–∞–∞—Ä
    user_context: ManyChat-–∞–∞—Å –∏—Ä–∂ –±–æ–ª–æ—Ö –Ω—ç–º—ç–ª—Ç –º—ç–¥—ç—ç–ª—ç–ª (–Ω—ç—Ä, —Ç–∞–≥ –≥–º)
    """
    # 1. –•”©—Ç”©–ª–±”©—Ä–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª
    course_answer = match_course_info(user_message)
    if course_answer:
        return course_answer

    # 2. FAQ
    faq_answer = match_faq(user_message)
    if faq_answer:
        return faq_answer

    # 3. AI —Ö–∞—Ä–∏—É “Ø“Ø—Å–≥—ç—Ö
    system_prompt = """
–¢–∞ Way Academy-–∏–π–Ω –Ω–∞–π—Ä—Å–∞–≥, –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω AI –∑”©–≤–ª”©—Ö —é–º.

=== –¢–ê–ù–ò–õ–¶–£–£–õ–ì–ê ===
Way Academy ‚Äî –£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä—Ç –±–∞–π—Ä–ª–∞–¥–∞–≥ —Å—É—Ä–≥–∞–ª—Ç—ã–Ω —Ç”©–≤
üìç –•–∞—è–≥: Galaxy Tower, 7 –¥–∞–≤—Ö–∞—Ä 705, –ú–∞—Ö–∞—Ç–º–∞ –ì–∞–Ω–¥–∏ –≥—É–¥–∞–º–∂
üìû –•–æ–ª–±–æ–æ –±–∞—Ä–∏—Ö: 99201187
‚úâ Email: hello@wayconsulting.io
üïê –ê–∂–∏–ª–ª–∞—Ö —Ü–∞–≥: –ê–∂–ª—ã–Ω ”©–¥”©—Ä 10:00‚Äì20:00, –ê–º—Ä–∞–ª—Ç—ã–Ω ”©–¥”©—Ä 11:00‚Äì18:00

=== –•”®–¢”®–õ–ë”®–†“Æ“Æ–î ===
‚Ä¢ –°—Ç—Ä–∞—Ç–µ–≥–∏–π–Ω –î–∏–∂–∏—Ç–∞–ª –ú–∞—Ä–∫–µ—Ç–µ—Ä (5 —Å–∞—Ä, Meta —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
‚Ä¢ Data Analyst (4 —Å–∞—Ä, Google —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä—Ç–∞–π)
‚Ä¢ IT Business Analyst (3 —Å–∞—Ä, 100% –∞–∂–ª—ã–Ω –±–∞–π—Ä—Ç–∞–π)
‚Ä¢ Project Zero: AI Agent Developer (4 —Å–∞—Ä, –æ–Ω—Ü–≥–æ–π —ç–ª—Å—ç–ª—Ç—Ç—ç–π)

=== –ê–ö–ê–î–ï–ú–ò–ô–ù –û–ù–¶–õ–û–ì ===
‚Ä¢ C-level —ç–∫—Å–ø–µ—Ä—Ç“Ø“Ø–¥ –∑–∞–∞–¥–∞–≥
‚Ä¢ –ë–æ–¥–∏—Ç —Ç”©—Å”©–ª –¥—ç—ç—Ä –∞–∂–∏–ª–ª–∞–Ω–∞
‚Ä¢ AI –Ω—ç–≤—Ç—Ä“Ø“Ø–ª—Å—ç–Ω —Å—É—Ä–≥–∞–ª—Ç
‚Ä¢ –¢”©–≥—Å—Å”©–Ω–∏–π –¥–∞—Ä–∞–∞ —á —Ç–∞—Å—Ä–∞–ª—Ç–≥“Ø–π –¥—ç–º–∂–ª—ç–≥
‚Ä¢ –ö–ª—É–±—É—É–¥: –∞–Ω–≥–ª–∏ —Ö—ç–ª, —É—É–ª—ã–Ω –∞–ª—Ö–∞–ª—Ç, –∫–∏–Ω–æ, –±–∏–∑–Ω–µ—Å

=== –¢–ê–ù–´ –•–ê–†–ò–õ–¶–ê–• –•–≠–í –ú–ê–Ø–ì ===
‚úÖ –ù–∞–π—Ä—Å–∞–≥, —Ö“Ø–Ω–ª—ç–≥, —Ç–æ–≤—á (2-4 ”©–≥“Ø“Ø–ª–±—ç—Ä)
‚úÖ Emoji –∑–æ—Ö–∏—Å—Ç–æ–π (1-3 —Ö–∞—Ä–∏—É–ª—Ç –±“Ø—Ä—Ç)
‚úÖ –ó”©–≤–ª”©–≥”©”© ”©–≥, —Ö–∞—Ä–∏–Ω –∞–ª–±–∞–¥–∞—Ö–≥“Ø–π
‚úÖ –•—ç—Ä—ç–≥—Ü—ç—ç–≥ —Ç–æ–¥—Ä—É—É–ª

‚ùå –†–æ–±–æ—Ç –º—ç—Ç –∞–ª–±–∞–Ω —ë—Å–æ–æ—Ä —è—Ä–∏—Ö–≥“Ø–π
‚ùå –•—ç—Ç —É—Ä—Ç —Ç–∞–π–ª–±–∞—Ä–≥“Ø–π
‚ùå "–¢–∞ –∑–∞–∞–≤–∞–ª..." –≥—ç—Ö –∑–∞—Ö–∏—Ä–≥–∞–∞ –±–∞–π—Ö–≥“Ø–π

üéØ –•–≠–†–≠–ì–¶–≠–≠ –¢–û–î–†–£–£–õ–ê–•:
"–ê–ª—å —Ö”©—Ç”©–ª–±”©—Ä –Ω–∞–¥–∞–¥ —Ç–æ—Ö–∏—Ä–æ—Ö –≤—ç?" ‚Üí –æ–¥–æ–æ–≥–∏–π–Ω –º—ç—Ä–≥—ç–∂–∏–ª, –∑–æ—Ä–∏–ª–≥–æ, —á”©–ª”©”©—Ç—ç–π —Ü–∞–≥–∏–π–≥ –∞—Å—É—É

üìû –£–¢–ê–° –ê–í–ê–• –°–¢–†–ê–¢–ï–ì–ò:
–•—ç—Ä—ç–≤ —Ö—ç—Ä—ç–≥–ª—ç–≥—á:
- –°–æ–Ω–∏—Ä—Ö–æ–ª—Ç–æ–π —Ö–∞—Ä–∞–≥–¥–∞–∂ –±–∞–π–Ω–∞
- –¢–æ–¥–æ—Ä—Ö–æ–π —Ö”©—Ç”©–ª–±”©—Ä –∞—Å—É—É—Å–∞–Ω
- –¢”©–ª–±”©—Ä, —ç–ª—Å—ç–ª—Ç–∏–π–Ω —Ç–∞–ª–∞–∞—Ä –∞—Å—É—É—Å–∞–Ω
‚Üí –≠–Ω–≥–∏–π–Ω, –Ω–∞–π—Ä—Å–∞–≥ –±–∞–π–¥–ª–∞–∞—Ä —É—Ç–∞—Å –∞–≤–∞—Ö—ã–≥ —Å–∞–Ω–∞–ª –±–æ–ª:

"–¢–∞–Ω–¥ –∏–ª“Ø“Ø —Ç–æ–¥–æ—Ä—Ö–æ–π –∑”©–≤–ª”©–≥”©”© ”©–≥”©—Ö–∏–π–Ω —Ç—É–ª–¥ –º–∞–Ω–∞–π –º—ç—Ä–≥—ç–∂–∏–ª—Ç—ç–Ω 2-5 –º–∏–Ω—É—Ç—ã–Ω –¥–æ—Ç–æ—Ä —Ö–æ–ª–±–æ–≥–¥–æ–∂ –±–æ–ª–æ—Ö —É—É? üòä

–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä–∞–∞ –±–∏—á—ç—ç–¥ —è–≤—É—É–ª–∞–∞—Ä–∞–π, —ç—Å–≤—ç–ª –¥–æ–æ—Ä—Ö —Ç–æ–≤—á–æ–æ—Ä —à—É—É–¥ –∏–ª–≥—ç—ç–≥—ç—ç—Ä—ç–π."

=== –°–ê–ù–ê–ú–ñ ===
‚Ä¢ –ó”©–≤—Ö”©–Ω –º–æ–Ω–≥–æ–ª–æ–æ—Ä —Ö–∞—Ä–∏—É–ª–Ω–∞
‚Ä¢ –ú—ç–¥—ç—Ö–≥“Ø–π –±–æ–ª 99201187 —Ä“Ø“Ø —á–∏–≥–ª“Ø“Ø–ª
‚Ä¢ –ù–∞–π—Ä—Å–∞–≥, —ç–Ω–≥–∏–π–Ω, —Ö“Ø–Ω–ª—ç–≥ –±–∞–π
"""

    # User context –Ω—ç–º—ç—Ö (—Ö—ç—Ä—ç–≤ –±–∞–π–≥–∞–∞ –±–æ–ª)
    user_info = ""
    if user_context:
        if user_context.get("first_name"):
            user_info += f"–•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –Ω—ç—Ä: {user_context['first_name']}\n"
        if user_context.get("tags"):
            user_info += f"–¢–∞–≥: {', '.join(user_context['tags'])}\n"

    messages = [
        {"role": "system", "content": system_prompt + (f"\n\n{user_info}" if user_info else "")},
        {"role": "user", "content": user_message}
    ]

    try:
        completion = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=messages,
            temperature=0.7,
            max_tokens=500
        )
        return completion.choices[0].message.content.strip()
    except Exception as e:
        print(f"OpenAI Error: {e}")
        return "–£—É—á–ª–∞–∞—Ä–∞–π, —Ç–µ—Ö–Ω–∏–∫–∏–π–Ω –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –¢–∞ 99201187 —Ä—É—É —à—É—É–¥ –∑–∞–ª–≥–∞–Ω–∞ —É—É üòä"


# ---------------- MANYCHAT WEBHOOK (–®–ò–ù–≠) ----------------

@app.post("/manychat-ai")
def manychat_webhook():
    """
    ManyChat-–∞–∞—Å External Request –±–ª–æ–∫–æ–æ—Ä –¥—É—É–¥–∞–≥–¥–∞—Ö endpoint.
    
    Expected JSON format:
    {
        "user_message": "—Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –º–µ—Å—Å–µ–∂",
        "first_name": "–ë–∞—Ç–∞–∞",
        "tags": ["interested", "data_analyst"]
    }
    
    Response:
    {
        "reply": "AI-–∏–π–Ω —Ö–∞—Ä–∏—É..."
    }
    """
    try:
        data = request.get_json()
        
        if not data:
            return jsonify({"error": "No JSON data received"}), 400
        
        user_message = data.get("user_message", "")
        
        if not user_message:
            return jsonify({"error": "user_message is required"}), 400
        
        # User context —Ü—É–≥–ª—É—É–ª–∞—Ö
        user_context = {
            "first_name": data.get("first_name"),
            "last_name": data.get("last_name"),
            "tags": data.get("tags", [])
        }
        
        # AI —Ö–∞—Ä–∏—É “Ø“Ø—Å–≥—ç—Ö
        ai_reply = generate_ai_reply(user_message, user_context)
        
        # ManyChat —Ä—É—É –±—É—Ü–∞–∞—Ö
        return jsonify({
            "reply": ai_reply,
            "status": "success"
        }), 200
        
    except Exception as e:
        print(f"ManyChat webhook error: {e}")
        return jsonify({
            "reply": "–£—É—á–ª–∞–∞—Ä–∞–π, —Ç–µ—Ö–Ω–∏–∫–∏–π–Ω –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –¢–∞ 99201187 —Ä—É—É —à—É—É–¥ –∑–∞–ª–≥–∞–Ω–∞ —É—É üòä",
            "status": "error",
            "error_message": str(e)
        }), 500


# ---------------- HEALTH CHECK ----------------

@app.get("/")
def health_check():
    """Server –∞–∂–∏–ª–ª–∞–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö"""
    return jsonify({
        "status": "running",
        "service": "Way Academy ManyChat AI",
        "version": "2.0"
    }), 200


@app.get("/health")
def health():
    """Railway-–¥ –∑–æ—Ä–∏—É–ª—Å–∞–Ω health check"""
    return jsonify({"status": "healthy"}), 200


# ---------------- –•–£–£–ß–ò–ù MESSENGER WEBHOOK (–•–∞–¥–≥–∞–ª–∞—Ö) ----------------

@app.get("/webhook")
def verify_webhook():
    """Facebook webhook verification"""
    mode = request.args.get("hub.mode")
    token = request.args.get("hub.verify_token")
    challenge = request.args.get("hub.challenge")

    if mode == "subscribe" and token == VERIFY_TOKEN:
        print("WEBHOOK VERIFIED!")
        return challenge, 200

    print("WEBHOOK VERIFICATION FAILED")
    return "Verification failed", 403


@app.post("/webhook")
def handle_webhook():
    """Facebook Messenger webhook (—Ö—É—É—á–∏–Ω, —Ö–∞–¥–≥–∞–ª–∞—Ö)"""
    data = request.get_json()
    print("===== MESSENGER EVENT =====")
    print(data)
    
    # –•—É—É—á–∏–Ω –∫–æ–¥–æ–æ —ç–Ω–¥ “Ø–ª–¥—ç—ç–∂ –±–æ–ª–Ω–æ (–∏—Ä—ç—ç–¥“Ø–π–¥ —Ö—ç—Ä—ç–≥–ª—ç—Ö –º–∞–≥–∞–¥–ª–∞–ª—Ç–∞–π –±–æ–ª)
    
    return "EVENT_RECEIVED", 200


# ---------------- Main ----------------

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run